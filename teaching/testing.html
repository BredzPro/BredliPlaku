<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep your existing head content and styles -->
    <!-- Adding annoying form styles -->
    <style>
        /* Add these to your existing styles */
        
        /* For the moving submit button */
        #submitBtn.evasive {
            transition: all 0.2s ease-out;
        }
        
        /* Countdown timer styling */
        .countdown-container {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #ddd;
            display: none; /* Hidden initially */
        }
        
        .countdown {
            font-size: 24px;
            font-weight: bold;
            color: #f44336;
        }
        
        /* Captcha styling */
        .captcha-container {
            background-color: #f5f5f5;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        
        .captcha-question {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        
        /* Checkbox marathon styling */
        .checkbox-marathon {
            margin: 15px 0;
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .checkbox-item {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
        }
        
        .checkbox-item input {
            margin-top: 5px;
            margin-right: 10px;
        }
        
        /* Typing test styling */
        .typing-test {
            margin: 15px 0;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .typing-text {
            font-style: italic;
            background-color: #eee;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            user-select: none;
        }
        
        /* For spinning loading indicators */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* For the annoying dialog boxes */
        .mini-modal {
            position: fixed;
            background-color: white;
            border: 2px solid #f44336;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
            max-width: 300px;
            animation: bounce 0.5s;
        }
        
        .mini-modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }

        /* Button effects */
        .btn-shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(5px); }
            50% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>

<body>
    <!-- Keep your existing body content until the absence form -->
    
    <!-- Modified absence form with asshole design features -->
    <script>
        // Add this to your existing JavaScript
        
        // For captcha generation
        function generateCaptcha() {
            const operations = ['+', '-', '*'];
            const op = operations[Math.floor(Math.random() * operations.length)];
            let num1, num2, answer;
            
            switch(op) {
                case '+':
                    num1 = Math.floor(Math.random() * 50) + 10;
                    num2 = Math.floor(Math.random() * 50) + 10;
                    answer = num1 + num2;
                    break;
                case '-':
                    num1 = Math.floor(Math.random() * 50) + 30;
                    num2 = Math.floor(Math.random() * 20) + 10;
                    answer = num1 - num2;
                    break;
                case '*':
                    num1 = Math.floor(Math.random() * 12) + 2;
                    num2 = Math.floor(Math.random() * 12) + 2;
                    answer = num1 * num2;
                    break;
            }
            
            return {
                question: `What is ${num1} ${op} ${num2}?`,
                answer: answer
            };
        }
        
        // Generate a new random position for the submit button
        function moveSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            if (!submitBtn || !submitBtn.classList.contains('evasive')) return;
            
            const container = document.querySelector('.form-buttons');
            const containerRect = container.getBoundingClientRect();
            
            // Random position within the container's boundaries
            const maxX = containerRect.width - submitBtn.offsetWidth;
            const maxY = containerRect.height - submitBtn.offsetHeight;
            
            // Only move if not all validations pass
            if (submitBtn.disabled) {
                const randomX = Math.random() * maxX;
                const randomY = Math.random() * 20 - 10; // Small vertical movement
                
                submitBtn.style.transform = `translate(${randomX}px, ${randomY}px)`;
            } else {
                submitBtn.style.transform = 'translate(0, 0)';
            }
        }
        
        // Start countdown timer
        function startCountdown(duration, display, callback) {
            let timer = duration;
            const interval = setInterval(() => {
                display.textContent = timer;
                
                if (--timer < 0) {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 1000);
            
            return interval;
        }
        
        // Generate a random position within viewport
        function getRandomPosition() {
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            return {
                x: Math.max(20, Math.floor(Math.random() * (windowWidth - 320))),
                y: Math.max(20, Math.floor(Math.random() * (windowHeight - 200)))
            };
        }
        
        // Create an annoying mini-modal dialog
        function createMiniModal(message, leftBtnText, rightBtnText, onLeftClick, onRightClick) {
            const position = getRandomPosition();
            
            const modal = document.createElement('div');
            modal.className = 'mini-modal';
            modal.style.left = `${position.x}px`;
            modal.style.top = `${position.y}px`;
            
            modal.innerHTML = `
                <div>${message}</div>
                <div class="mini-modal-buttons">
                    <button class="btn-blue mini-btn">${leftBtnText}</button>
                    <button class="btn-red mini-btn">${rightBtnText}</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const buttons = modal.querySelectorAll('button');
            buttons[0].addEventListener('click', () => {
                modal.remove();
                if (onLeftClick) onLeftClick();
            });
            
            buttons[1].addEventListener('click', () => {
                modal.remove();
                if (onRightClick) onRightClick();
            });
            
            return modal;
        }
        
        // Add typo correction annoyance
        function addTypoCorrection(inputField, errorField) {
            inputField.addEventListener('blur', function() {
                if (this.value.trim() !== '' && Math.random() < 0.3) {
                    // 30% chance of suggesting a "correction"
                    const originalValue = this.value;
                    setTimeout(() => {
                        createMiniModal(
                            `Did you mean "${originalValue.charAt(0).toUpperCase() + originalValue.slice(1)}" instead of "${originalValue}"?`,
                            "Yes, fix it",
                            "No, keep it",
                            () => {
                                this.value = originalValue.charAt(0).toUpperCase() + originalValue.slice(1);
                                errorField.style.display = 'none';
                                this.classList.remove('error');
                                validateForm();
                            },
                            () => {}
                        );
                    }, 500);
                }
            });
        }
        
        // Extended form validation to include asshole design elements
        document.addEventListener('DOMContentLoaded', function() {
            // Get existing form elements
            const form = document.getElementById('absenceForm');
            if (!form) return;
            
            const nameField = document.getElementById('studentName');
            const idField = document.getElementById('studentID');
            const emailField = document.getElementById('studentEmail');
            const dateField = document.getElementById('absenceDate');
            const reasonField = document.getElementById('absenceReason');
            const explanationField = document.getElementById('absenceExplanation');
            const documentField = document.getElementById('absenceDocument');
            const honorCodeField = document.getElementById('honorCode');
            const submitBtn = document.getElementById('submitBtn');
            
            // Error message elements
            const nameError = document.getElementById('nameError');
            const idError = document.getElementById('idError');
            const emailError = document.getElementById('emailError');
            const dateError = document.getElementById('dateError');
            
            // Add captcha container after the honor code
            const captchaContainer = document.createElement('div');
            captchaContainer.className = 'captcha-container';
            captchaContainer.innerHTML = `
                <div class="captcha-question" id="captcha-question"></div>
                <input type="number" id="captcha-answer" placeholder="Enter your answer" required>
                <small class="error-message" id="captchaError" style="display: none;">Incorrect answer. Please try again.</small>
            `;
            
            // Add countdown timer container
            const countdownContainer = document.createElement('div');
            countdownContainer.className = 'countdown-container';
            countdownContainer.innerHTML = `
                <p>Please wait before submitting... <span class="countdown" id="countdown">30</span> seconds remaining</p>
            `;
            
            // Checkbox marathon container
            const checkboxMarathon = document.createElement('div');
            checkboxMarathon.className = 'checkbox-marathon';
            
            // Generate the checkbox marathon items
            const checkboxItems = [
                "I understand that absence reports are recorded permanently in my student record.",
                "I acknowledge that excessive absences may result in automatic course failure.",
                "I confirm that I have reviewed the course attendance policy in detail.",
                "I understand that this absence may affect my participation grade.",
                "I agree to catch up on any missed material on my own time.",
                "I acknowledge that makeup work is at the instructor's discretion.",
                "I understand that submitting this form does not guarantee approval.",
                "I certify that I am not using this absence to avoid scheduled tests or deadlines."
            ];
            
            let checkboxHTML = '<div style="font-weight: bold; margin-bottom: 10px;">Please confirm the following statements:</div>';
            
            checkboxItems.forEach((item, index) => {
                checkboxHTML += `
                    <div class="checkbox-item">
                        <input type="checkbox" id="marathon-check-${index}" class="marathon-checkbox" required>
                        <label for="marathon-check-${index}">${item}</label>
                    </div>
                `;
            });
            
            checkboxMarathon.innerHTML = checkboxHTML;
            
            // Create typing test
            const typingTest = document.createElement('div');
            typingTest.className = 'typing-test';
            
            const typingPhrases = [
                "I am aware that academic integrity is fundamental to the educational process.",
                "Education is not the filling of a pail, but the lighting of a fire.",
                "The future depends on what you do today, not tomorrow."
            ];
            
            const randomPhrase = typingPhrases[Math.floor(Math.random() * typingPhrases.length)];
            
            typingTest.innerHTML = `
                <div>Type the following text exactly as shown:</div>
                <div class="typing-text" id="typing-reference">${randomPhrase}</div>
                <input type="text" id="typing-input" placeholder="Type the text here">
                <small class="error-message" id="typingError" style="display: none;">Please type the text exactly as shown.</small>
            `;
            
            // Insert all these elements into the form
            const honorCodeGroup = document.querySelector('.form-group.checkbox-group');
            honorCodeGroup.parentNode.insertBefore(checkboxMarathon, honorCodeGroup.nextSibling);
            honorCodeGroup.parentNode.insertBefore(typingTest, checkboxMarathon.nextSibling);
            honorCodeGroup.parentNode.insertBefore(captchaContainer, typingTest.nextSibling);
            
            const formButtons = document.querySelector('.form-buttons');
            formButtons.parentNode.insertBefore(countdownContainer, formButtons);
            
            // Make submit button move around
            submitBtn.classList.add('evasive');
            
            // Set up captcha
            const captchaQuestion = document.getElementById('captcha-question');
            const captchaAnswer = document.getElementById('captcha-answer');
            const captchaError = document.getElementById('captchaError');
            
            let currentCaptcha = generateCaptcha();
            captchaQuestion.textContent = currentCaptcha.question;
            
            captchaAnswer.addEventListener('input', function() {
                if (parseInt(this.value) === currentCaptcha.answer) {
                    captchaError.style.display = 'none';
                } else {
                    captchaError.style.display = 'block';
                }
                validateForm();
            });
            
            // Set up typing test validation
            const typingReference = document.getElementById('typing-reference');
            const typingInput = document.getElementById('typing-input');
            const typingError = document.getElementById('typingError');
            
            typingInput.addEventListener('input', function() {
                if (this.value === typingReference.textContent) {
                    typingError.style.display = 'none';
                } else {
                    typingError.style.display = 'block';
                }
                validateForm();
            });
            
            // Select all marathon checkboxes
            const marathonCheckboxes = document.querySelectorAll('.marathon-checkbox');
            
            // Add event listeners to marathon checkboxes
            marathonCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', validateForm);
            });
            
            // Add annoying typo correction
            addTypoCorrection(nameField, nameError);
            addTypoCorrection(explanationField, document.getElementById('explanationError'));
            
            // Add mouseover event to make button dodge if form is invalid
            submitBtn.addEventListener('mouseover', function() {
                if (this.disabled) {
                    moveSubmitButton();
                }
            });
            
            // Enhance form submission
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                
                if (submitBtn.disabled) {
                    // Shake button and return if disabled
                    submitBtn.classList.add('btn-shake');
                    setTimeout(() => {
                        submitBtn.classList.remove('btn-shake');
                    }, 500);
                    return false;
                }
                
                // Show loading spinner on button
                const originalBtnText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<span class="spinner"></span> Processing...';
                submitBtn.disabled = true;
                
                // Wait a random time (2-5 seconds) for "processing"
                setTimeout(() => {
                    // 10% chance of a submission "error" that requires retry
                    if (Math.random() < 0.1) {
                        submitBtn.innerHTML = originalBtnText;
                        submitBtn.disabled = false;
                        
                        createMiniModal(
                            "Our system encountered an unexpected error. Would you like to try again?",
                            "Try again",
                            "Cancel",
                            () => {},
                            () => {
                                document.getElementById('close-absence-btn').click();
                            }
                        );
                    } else {
                        // Normal submission flow
                        const referenceID = generateReferenceID();
                        document.getElementById('referenceID').textContent = referenceID;
                        
                        // Set confirmation message based on reason
                        const reason = reasonField.value;
                        const confirmationMessage = document.getElementById('confirmationMessage');
                        
                        switch(reason) {
                            case 'Illness':
                                confirmationMessage.textContent = "I hope you feel better soon. Your absence has been recorded.";
                                break;
                            case 'Transport':
                                confirmationMessage.textContent = "Your transportation-related absence has been recorded.";
                                break;
                            case 'Family':
                                confirmationMessage.textContent = "I'm sorry to hear about your family emergency. I hope things get better soon.";
                                break;
                            case 'Other':
                                confirmationMessage.textContent = "Your absence has been recorded.";
                                break;
                        }
                        
                        // Form submission to Google Form would go here
                        
                        // Show confirmation modal
                        document.getElementById('confirmationModal').style.display = 'block';
                        
                        // Reset form
                        form.reset();
                        
                        // Reset additional elements
                        if (dateField) {
                            dateField.value = new Date().toISOString().split('T')[0];
                        }
                        
                        document.getElementById('charCount').textContent = '0';
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = originalBtnText;
                        
                        // Generate new captcha
                        currentCaptcha = generateCaptcha();
                        captchaQuestion.textContent = currentCaptcha.question;
                        captchaAnswer.value = '';
                        
                        // Reset typing test
                        typingInput.value = '';
                        
                        // Hide the form
                        document.getElementById('absence-container').classList.remove('visible');
                        document.getElementById('absenceButton').style.display = 'inline-block';
                    }
                }, Math.random() * 3000 + 2000);
                
                return false;
            });
            
            // Enhanced validation function
            window.validateForm = function() {
                if (!submitBtn) return;
                
                // Basic field validation (from your original code)
                const nameValid = nameField && nameField.value.trim() !== '';
                const idValid = idField && idField.value.match(/^[0-9]+$/);
                const emailValid = emailField && emailField.value.match(/[a-zA-Z0-9._%+-]+@epoka\.edu\.al$/);
                
                // Date validation
                let dateValid = false;
                if (dateField) {
                    const selectedDate = new Date(dateField.value + 'T00:00:00');
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    const twoDaysAgo = new Date(today);
                    twoDaysAgo.setDate(today.getDate() - 2);
                    
                    const oneWeekLater = new Date(today);
                    oneWeekLater.setDate(today.getDate() + 7);
                    
                    dateValid = selectedDate >= twoDaysAgo && selectedDate <= oneWeekLater;
                }
                
                // Reason validation
                const reasonValid = reasonField && reasonField.value !== '' && reasonField.value !== null;
                
                // Explanation validation
                let explanationValid = false;
                if (explanationField) {
                    const minLength = parseInt(explanationField.getAttribute('minlength') || '50');
                    explanationValid = explanationField.value.length >= minLength;
                }
                
                // Document validation (required only for illness)
                let documentValid = true;
                if (documentField && reasonField && reasonField.value === 'Illness') {
                    documentValid = documentField.files.length > 0;
                }
                
                // Honor code validation
                const honorValid = honorCodeField && honorCodeField.checked;
                
                // Additional asshole design validations
                
                // Captcha validation
                const captchaValid = captchaAnswer && parseInt(captchaAnswer.value) === currentCaptcha.answer;
                
                // Typing test validation
                const typingValid = typingInput && typingInput.value === typingReference.textContent;
                
                // Marathon checkboxes validation
                const marathonValid = Array.from(marathonCheckboxes).every(checkbox => checkbox.checked);
                
                // Enable submit button only if all validations pass
                submitBtn.disabled = !(nameValid && idValid && emailValid && dateValid && 
                                    reasonValid && explanationValid && documentValid && 
                                    honorValid && captchaValid && typingValid && marathonValid);
                
                // If the form becomes valid, show the countdown
                if (!submitBtn.disabled && countdownContainer.style.display !== 'block') {
                    countdownContainer.style.display = 'block';
                    const countdownDisplay = document.getElementById('countdown');
                    
                    // Start a 30-second countdown
                    const countdownInterval = startCountdown(30, countdownDisplay, () => {
                        countdownContainer.innerHTML = '<p style="color: green; font-weight: bold;">You may now submit your form.</p>';
                        submitBtn.style.transform = 'translate(0, 0)';
                    });
                    
                    // Disable submit button during countdown
                    submitBtn.disabled = true;
                    
                    // Re-enable after countdown
                    setTimeout(() => {
                        if (nameValid && idValid && emailValid && dateValid && 
                            reasonValid && explanationValid && documentValid && 
                            honorValid && captchaValid && typingValid && marathonValid) {
                            submitBtn.disabled = false;
                        }
                    }, 30000);
                }
                
                // If form is invalid, reset the countdown
                if (submitBtn.disabled && countdownContainer.style.display === 'block') {
                    countdownContainer.style.display = 'none';
                }
            };
            
            // Add random "Are you sure?" dialogs when trying to click submit
            submitBtn.addEventListener('click', function(event) {
                if (!this.disabled && Math.random() < 0.3) {
                    event.preventDefault();
                    
                    const messages = [
                        "Are you absolutely sure you want to submit this absence report?",
                        "This absence will be permanently recorded. Continue?",
                        "Your instructor will be notified immediately. Proceed?"
                    ];
                    
                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    
                    createMiniModal(
                        randomMessage,
                        "Yes, submit",
                        "No, check again",
                        () => {
                            // Submit the form
                            form.dispatchEvent(new Event('submit'));
                        },
                        () => {}
                    );
                }
            });
            
            // Add random focus loss on typing
            explanationField.addEventListener('input', function() {
                if (Math.random() < 0.05 && this.value.length > 10) {
                    // 5% chance of focus being moved to another field
                    const randomField = [nameField, idField, emailField][Math.floor(Math.random() * 3)];
                    setTimeout(() => {
                        randomField.focus();
                    }, 100);
                }
            });
            
            // Add random field reset
            const fields = [nameField, idField, emailField, dateField, reasonField, explanationField];
            
            fields.forEach(field => {
                if (!field) return;
                
                field.addEventListener('blur', function() {
                    if (Math.random() < 0.02) {
                        // 2% chance of clearing a field when user leaves it
                        const fieldValue = this.value;
                        setTimeout(() => {
                            createMiniModal(
                                "Our system detected unusual input. Would you like to clear and retry?",
                                "Yes, clear field",
                                "No, keep it",
                                () => {
                                    this.value = '';
                                    validateForm();
                                },
                                () => {
                                    this.value = fieldValue;
                                }
                            );
                        }, 500);
                    }
                });
            });
        });
        
        // Keep your other existing JavaScript functions unchanged
    </script>
</body>
</html>